app_post:
    resource: |
        alias: app.post
        form: AppBundle\Form\Type\PostType
        templates: :frontend/post
    type: sylius.resource

app_post_update:
    methods: [GET, PUT]
    path: /posts/{id}/edit
    defaults:
        _controller: app.controller.post:updateAction
        _sylius:
            repository:
                method: findOneBy
                arguments: [{id: $id, createdBy: expr:service('sylius.context.customer').getCustomer().getUser()}]
            redirect:
                route: app_post_index_by_topic
                parameters: { topicId: resource.topic.id }
            template: frontend/topic/update.html.twig

app_post_index_by_topic:
    methods: [GET]
    path: /topics/{topicId}/posts/
    defaults:
        _controller: app.controller.post:indexByTopicAction
        _sylius:
            paginate: 10
            criteria:
                topic: $topicId
            sorting:
                createdAt: asc
            template: frontend/post/index.html.twig

app_post_create_by_topic:
    methods: [GET, POST]
    path: /topics/{topicId}/posts/new
    defaults:
        _controller: app.controller.post:createAction
        _sylius:
            form: AppBundle\Form\Type\PostType
            factory:
                method: createNewWithTopic
                arguments:
                    - $topicId
                    - expr:service('app.repository.topic')
            paginate: 10
            template: frontend/post/create.html.twig
            redirect:
                route: app_post_index_by_topic
                parameters: { topicId: $topicId }