{% extends "base.html.twig" %}
{% from 'macros/misc.html.twig' import pagination %}
{% from 'macros/users.html.twig' import avatar %}
{% from 'macros/images.html.twig' import image %}
{% import 'macros/buttons.html.twig' as button %}
{% from 'macros/topics.html.twig' import getPath %}
{% from 'macros/sorting.html.twig' import sorting %}

{% block body_class %}magazine{% endblock %}

{% block headline %}
    {% if taxon is defined %}
        {{ taxon }}
    {% else %}
        Forum
    {% endif %}
{% endblock %}

{% block subtitle %}
    {% if taxon is defined %}
        {{ taxon.description }}
    {% endif %}
{% endblock %}

{% block breadcrumb_content %}
    {{ parent() }}
    <a href="{{ path('app_topic_index') }}">Forum</a>
    {% if taxon is defined %}
        / {{ taxon }}
    {% endif %}
{% endblock %}

{% block body -%}
    <div class="container">

        <div class="row">
            <div class="col-md-8">

                <div class="container">

                    <div class="pull-right sorting">
                        {% set sorting = app.request.get('sorting') %}

                        {% set icon = false %}
                        {% set currentOrder = null %}

                        {% if null == sorting %}
                            {% set icon = true %}
                            {% set currentOrder = 'desc' %}
                        {% endif %}

                        {% set routeName =  app.request.get('_route') %}
                        {% set routeParams =  app.request.get('_route_params') %}

                        Trier
                        par {{ sorting(routeName, 'label.created_at'|trans, 'createdAt', 'desc', icon, currentOrder, routeParams) }},
                        {{ sorting(routeName, 'label.most_commented'|trans, 'postCount', 'desc', null, null, routeParams) }}
                    </div>

                    <div class="clearfix"></div>

                    {% for topic in topics %}

                        {% set user = topic.createdBy %}
                        {% set imagePath = avatar(user) %}
                        {% set linkUrl = getPath(topic) %}

                        {% set meta %}
                            <!-- Date -->
                            <a href="#"><i class="fa fa-calendar"></i>
                                &nbsp; {{ topic.createdAt|localizeddate('long', 'none') }}</a>
                            &nbsp;
                            <!-- Author -->
                            <a href="#"><i class="fa fa-customer"></i> &nbsp; {{ user }}</a>
                            &nbsp;
                            <!-- Comments -->
                        {% set commentCount = topic.posts|length %}
                            <a href="#"><i class="fa fa-comments"></i> &nbsp; {{ commentCount }} <span
                                        class="hidden-xs">Commentaire{% if commentCount > 1 %}s{% endif %}</span></a> &nbsp;
                        {% endset %}

                        <div class="blog-author well">
                            <!-- Author image -->
                            <div class="blog-author-img">
                                {{ image(imagePath, 'thumbnail', user.username, 'img-responsive img-round', linkUrl) }}
                            </div>
                            <!-- Author details -->
                            <div class="blog-author-content">
                                <div class="pull-right hidden-xs">
                                    <a href="{{ linkUrl }}" class="btn btn-color">
                                        <span class="fa fa-arrow-circle-o-right"></span>
                                        Lire le sujet
                                    </a>
                                </div>
                                <h5><a href="{{ linkUrl }}">{{ topic.title }}</a></h5>
                                {{ meta|raw }}
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    {% endfor %}
                </div>


                {% block Pagination %}
                    {{ pagination(topics) }}
                {% endblock %}
            </div>
            <div class="col-md-4">
                {% include 'frontend/topic/_sidebar.html.twig' %}
            </div>
        </div>
    </div>
{% endblock %}